<?lua
require "teamf1lualib/selfCertificateRequest_bl"
require "teamf1lualib/errorMap"
require "teamf1lualib/returnCodes"

local selfCertReq = require ("com.teamf1.bl.certificates.selfCertRequest")
local returnCodes = require ("com.teamf1.core.returnCodes")
local configRowId
if(ButtonType == "add") then
    configRowId = "-1"
end
cgilua.header ("Content-Type", "text/html; charset=UTF-8")
?>
<?lua if(ButtonType == "add") then ?>
<div id="tf1_selfCertificateRequestDailogContent">
	<div class="topBg">
    	<h1 data-localize="11065">Generate Self Certificate Request</h1>
    	<close>
    		<a href="#" id="btnClose" title="Close">X</a>
    	</close>
    </div>
    <div class="dialogMidArea">
    	<div class="configRow">
    		<label data-localize="11748">Name</label>
    		<input type="text" maxlength="32" name ="selfCertificateRequest.name" id="tf1_requestName">
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="13015">Subject</label>
    		<input type="text" maxlength="128" name ="selfCertificateRequest.subject" id="tf1_subjectName">
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="11102">Hash Algorithm</label>
    		<select name ="selfCertificateRequest.hashAlo" id="tf1_hashAlgo">
			   <option data-localize="11701" value="1">MD5</option>
			    <option data-localize="14106" value="2">SHA1</option>
            </select>
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="12861">Signature Key Length</label>
    		<select name ="selfCertificateRequest.signatureKeyLength" id="tf1_signatureKeyLength">
				<option value="1">512</option>
				<option value="2">1024</option>
				<option value="3">2048</option>
			</select>
    	</div>
    	<div class="break">&nbsp;</div>
        
        <div class="configRow">
    		<label data-localize="10276">Application Type</label>
    		<select name ="selfCertificateRequest.appType" id="tf1_appType">
				<option data-localize="11129" value="https">HTTPS</option>
				<option data-localize="11419" value="ipsec">IPSec</option>
			</select>
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="11387">IP Address</label>
    		<input type="text" name ="selfCertificateRequest.ipAddress" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', true, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }" onkeypress="return numericValueCheck (event, '.')" id="tf1_IPAddr"  maxlength="15">
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="10805">Domain Name</label>
    		<input type="text" name ="selfCertificateRequest.domainName" id="tf1_domainName">
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="10866">Email Address</label>
    		<input type="text" name ="selfCertificateRequest.emailAddress" id="tf1_emailAddress">
    	</div>
    	<div class="break">&nbsp;</div>
     </div>
     <div class="dialogSubmitRow">
     	<input data-localize="12758" type="submit" onclick="return selfCertInfoValidate();" class="btnSubmit" title="Save" name="button.config.selfCertificateRequest.selfCertificateRequest.$|configRowId|$" value="Save" id="btSave">
	</div>
</div>
<?lua elseif(ButtonType == "view") then
configRowId = cgi["configRowId"]
returnCode, cookie, subjectName, hashAlgo, signatureAlgo, 
signatureKeyLen, selfCertData = 
               selfCertReq.certificateDetailsGet(configRowId)
?>
<div id="tf1_selfCertificateViewDailogContent">
	<div class="topBg">
    	<h1 data-localize="14113">Certificate Details</h1>
    	<close>
    		<a href="#" id="btnClose" title="Close">X</a>
    	</close>
    </div>
    <div class="dialogMidArea">
    	<div class="configRow">
    		<label data-localize="13042">System Name</label>
                $| subjectName or '' |$
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="11102">Hash Algorithm</label>
                 $| hashAlgo or '' |$
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="14112">Signature Algorithm</label>
                $| signatureAlgo or '' |$
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="14111">Key length</label>
                $| signatureKeyLen or '' |$
    	</div>
    	<div class="break">&nbsp;</div>
    	
    	<div class="configRow">
    		<label data-localize="14110">Data to supply to CA</label>
               <textarea type="text" rows="3" cols="10" readonly style="margin:0">$| selfCertData or '' |$</textarea>
    	</div>
    	<div class="break">&nbsp;</div>
    	
</div>
<?lua end?>
