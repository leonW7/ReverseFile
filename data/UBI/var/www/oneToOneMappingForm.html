<?lua 
    require "teamf1lualib/errorMap"
    require "teamf1lualib/returnCodes"
    require "teamf1lualib/oneToOneMapping_bl"
    
    local returnCodes = require ("com.teamf1.core.returnCodes")
    local errorMap = require("com.teamf1.core.errorMap")
    local bl_mapping = require("com.teamf1.bl.oneToOneMapping")
if(ButtonType == "add" or ButtonType == "edit") then
    local returnCode, statusMessage
    local mappingTbl = {}
    if (ButtonType and ButtonType == "edit") then
        configRowId = cgi["configRowId"]
        returnCode, mappingTbl = bl_mapping.oneToOneMappingSectionGet (configRowId) 
        if (returnCode == returnCodes.SUCCESS) then
            statusSuccessMessage = errorMap.errorStringGet (returnCode)
        else 
            statusErrorMessage = errorMap.errorStringGet (returnCode)
	end
    else
        configRowId = "-1"
    end
    cgilua.header ("Content-Type","text/html; charset=UTF-8")
?>
<div id="tf1_oneToOneMappingDailogContent">
    <div class="topBg">
        <h1 data-localize="30209">IPSec One To One Mapping Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">
        <div align="left">
            <div class="configRow" id="tf1_sourceIPAddr_div">
                <label data-localize="30204">Source IP Range Start</label>
                    <input type="text" name="oneToOneMapping.sourceIpStart" value="$| mappingTbl["IpsecLocalTrafficSelectorMapping.sourceIpStart"] or '' |$" id="tf1_sourceIPAddr" size="20" maxlength="15" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }" >
            </div>
            <div class="break" id="break_sourceIPAddr">&nbsp;</div>
            <div class="configRow" id="tf1_mappedIPAddr_div">
                <label data-localize="30205">Mapped IP Range Start</label>
                    <input type="text" name="oneToOneMapping.mappedIpStart" value="$| mappingTbl["IpsecLocalTrafficSelectorMapping.mappedIpStart"] or '' |$" id="tf1_mappedIPAddr" size="20" maxlength="15" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }" >
            </div>
            <div class="break" id="break_mappedIPAddr">&nbsp;</div>
            <div class="configRow" id="tf1_rangeLength_div">
                <label data-localize="30206">Range Length</label>
                <input type="text" name="oneToOneMapping.rangeLength" id="tf1_rangeLength" value="$| mappingTbl["IpsecLocalTrafficSelectorMapping.rangeLength"] or '' |$" size="5" maxlength="3" class="one" onkeypress="return numericValueCheck (event)" onkeydown="if (event.keyCode == 9) {return numericValueRangeCheck (this, '', '', 1, 254, true, LANG_LOCALE['30211']+': ', '');}">
                <dl>[<span data-localize="12627">Range</span>: 1 - 254]</dl>
            </div>
            <div class="break" id="break_rangeLength">&nbsp;</div>
            <div class="configRow" id="tf1_selPolicyName_div">
                <label data-localize="30207">IPSec Policy Name</label>
                    <select size="1" name="oneToOneMapping.vpnPolicyName" id="tf1_selPolicyName">
                    <?lua
                        local returnCode, table = bl_mapping.vpnPoliciesGetAll ()
                        local i = 0
                        for k,v in pairs(table) do
                            i = i + 1
                            local row = table[i]
                    ?>
                        <option $| web.dropdownSelected(mappingTbl["IpsecLocalTrafficSelectorMapping.vpnPolicyName"] == row["IpsecVPNPolicy.VPNPolicyName"]) |$ value="$| row["IpsecVPNPolicy.VPNPolicyName"] |$">$| row["IpsecVPNPolicy.VPNPolicyName"] |$</option>
                    <?lua end ?>         
                    </select>
            </div>
            <div class="break" id="break_selPolicyName">&nbsp;</div>
        </div>
    </div>
    <div class="dialogSubmitRow">
        <input data-localize="12758" type="submit" name="button.config.oneToOneMapping.oneToOneMapping.$|configRowId|$" onclick="return oneToOneMappingValidation()" class="btnSubmit" title="Save" value="Save" id="btSave">
    </div>
</div>
<!-- Section for Pop up dialog ends -->
<?lua end ?>
