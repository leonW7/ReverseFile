<?lua
loginInfo = nil
require "teamf1lualib/login"
-- logout
local result, errorStr = login.logout(cgilua.cookies.get("TeamF1Login"), SAPI.Request.servervariable("REMOTE_ADDR"))
--if success, delete cookie
if (result == 0) then
    cgilua.cookies.set("TeamF1Login", cgilua.cookies.get("TeamF1Login"), {expires=-1})
    util.appendDebugOut("SUCCESSFULLY LOGGED OUT!<br>")
end

-- if login button
if (ButtonType and ButtonType == "login") then
    local inputTable = web.cgiToLuaTable(cgi)
    -- authenticate and login
    local status,statusMsg,loginConf
    if (HIGH_SEC == HIGH_SEC_LEVEL) then
       if (os.getenv("HTTP_REFERER") == nil or os.getenv("HTTP_REFERER") == '')then
	      Page = "index"
              statusMsg = "Invalid http refer"
       else
              status,statusMsg,loginConf = login.login(inputTable)
       end
    else
       status,statusMsg,loginConf = login.login(inputTable)
    end
    if (status == 0) then
        util.appendDebugOut("VALID LOGIN!<br>")    
        util.appendDebugOut("NORMAL LOGIN!<br>")
            web.goToPage(NextPage, true, true)    
    elseif (status == 1) then 
        util.appendDebugOut("REPEAT LOGIN!<br>")
        statusMessage = statusMsg
        loginInfo = loginConf
        errorFlag = "OK"
        web.goToPage(FORCED_LOGIN_PAGE, false, true)
    elseif (status == 2) then 
        util.appendDebugOut("SSL LOGIN!<br>")
        web.goToPage(SSL_PORTAL_PAGE, false, true)
    elseif (status == 3) then 
        util.appendDebugOut("REPEAT LOGIN!<br>")
        statusMessage = statusMsg
        errorFlag = "OK"
        web.goToPage(Page, true, true)
    else
       util.appendDebugOut("INVALID LOGIN. TRY AGAIN!<br>")
       statusMessage = statusMsg
        -- go back to login page
        web.goToPage(Page, true, true)    
    end
else
	if (cgi["redirectStatusMessage"] ~= nil and cgi["redirectStatusMessage"] ~= '') then
  		statusMessage = cgi["redirectStatusMessage"]
	end
cgilua.header ("Content-Type","text/html; charset=UTF-8")

LANG_LOCALE = "30002,30003,11617,13242,11899,11617,14381,14382,20012,20005,14383,12144,12333"
?>
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Language" content="en-us">
        <title>$|COMPANY_NAME|$ : $|APP_NAME|$</title>
<!--
Copyright (c) 2012 - 2013 TeamF1, Inc. (www.TeamF1.com)
copyright (c) 2008-2015, TeamF1 Networks Pvt. Ltd. 
(Subsidiary of D-Link India)
All rights reserved.
-->
        <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="css/buttons.css" />
        <link rel="stylesheet" type="text/css" href="css/menu.css" />
        <script type="text/javascript" language="javascript" src="js/jquery-1.8.0.min.js"></script>
        <?lua web.includeMenu("metaInclude.html")?>
    </head>
    <body>
        <table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
                <td class="header" valign="top" align="center">
                <?lua web.includeMenu("headerPlain.html")?></td>
            </tr>
            <tr>
                <td valign="top" align="center">
                <div class="midWidth2">
										<?lua if (statusMessage ~= nil and statusMessage ~= '') then ?>
										  <div class="blank">
                      	&nbsp;
                      </div>
											<div class="msgError">
		                  	<p>$| statusMessage |$</p>
		                  </div>
											<div class="blank">
                      	&nbsp;
                      </div>
										<?lua end ?>
                    <div class="FL2">
                        <p class="hint">
                            $| LANG_LOCALE['30002'] |$
                            ($| UNIT_NAME |$) $| LANG_LOCALE['30003'] |$.
                        </p>
                    </div><h1>$| LANG_LOCALE['11617'] |$</h1>
                    <div class="midArea">
                        <div class="configLogin">
                            <form method="post" action="platform.cgi" name="tf1_frmIndex" id="tf1_frmIndex">
                							<input type="hidden" name="thispage" value="index.html">
                                <div class="break">
                                    &nbsp;
                                </div>
                                <div class="configRow">
                                    <label>$| LANG_LOCALE['13242'] |$</label>
                                    <input name="Users.UserName" type="text" id="tf1_userName">
                                </div>
                                <div class="break">
                                    &nbsp;
                                </div>
                                <div class="configRow">
                                    <label>$| LANG_LOCALE['11899'] |$</label>
                                    <input name="Users.Password" type="password" id="tf1_password" >
                                </div>
                                <div class="break">
                                    &nbsp;
                                </div>
                                <!--<div class="configRow">
                                    <label> Select Language </label>
                                    <select size="1" name id>
                                        <option value="1">Chinese</option>
                                        <option value="2">German</option>
                                        <option value="3">Italian</option>
                                        <option value="4">Japanese</option>
                                        <option value="5">Spanish</option>
                                        <option value="6" selected>English [US]</option>
                                    </select>
                                </div>
                                <div class="break">
                                    &nbsp;
                                </div>
                                <div class="configRow">
                                    <label> &nbsp; </label>
                                    <p>
                                        <input type="checkbox" value="0" checked>
                                        Remember Password
                                    </p>
                                </div>
                                <div class="break">
                                    &nbsp;
                                </div>-->
                <div class="submitRow2">
                    <input type="submit" name ="button.login.Users.dashboard"
                    class="btnSubmit" title="$| LANG_LOCALE['11617'] |$" value="$| LANG_LOCALE['11617'] |$" id="tf1_btnLogin" onclick="return loginValidate()" >
                </div>
                <input type="hidden" name="Login.userAgent" id="tf1_hdUserAgent">
            <input type="hidden" name="loggedInStatus" id="loggedInStatus" value="$| errorStr or '' |$">
                <div class="break">
                    &nbsp;
                </div>
                </form>
		            <script language="javascript" type="text/javascript">
		    			if(document.getElementById ('tf1_hdUserAgent'))
		    			document.getElementById ('tf1_hdUserAgent').value = navigator.userAgent;
		        	</script>
                        </div>
                    </div>
                </div></td>
            </tr>
            <tr>
            <td>
            <p class="supported"> <b>$| LANG_LOCALE['14381'] |$: </b>$| LANG_LOCALE['14382'] |$ 9+, $| LANG_LOCALE['20012'] |$ 20+, $| LANG_LOCALE['20005'] |$ 25+, $| LANG_LOCALE['14383'] |$ 5+ </p>
            </td>
            </tr>
            <tr>
                <td>
                <?lua web.includeMenu("footer.html")?></td>
            </tr>
        </table>
        <script type="text/javascript" language="javascript" src="js/mis.js"></script>
				<script type="text/javascript" language="javascript" src="js/textValidations.js"></script>
				<script type="text/javascript" charset="utf-8">        
				   function loginValidate()
						{
							var txtFieldIdArr = new Array ();
							txtFieldIdArr[0] = "tf1_userName,"+LANG_LOCALE['12144'];
							txtFieldIdArr[1] = "tf1_password,"+LANG_LOCALE['12333'];
					
							if (txtFieldArrayCheck (txtFieldIdArr) == false)
							return false;
					
							return true;
						}
				
						function loginInit ()
						{
							var usrObj = document.getElementById ('tf1_userName');
							if (!usrObj) return;
							usrObj.focus ();
						}

						$(document).ready(function(){
							loginInit();            	
            });
			</script>
    </body>
</html>
<?lua end ?>
