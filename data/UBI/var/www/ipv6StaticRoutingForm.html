<?lua
require "teamf1lualib/ipv6_static_routes_bl"
require "teamf1lualib/returnCodes"
local staticRoutes6 = require("com.teamf1.bl.ipv6.ipv6_wanclients.static_routes")
if(ButtonType == "add" or ButtonType == "edit") then
    local returnCode, cookie
    local staticRouteTbl = {}
    if (ButtonType and ButtonType == "edit") then
        configRowId = cgi["configRowId"]
        returnCode, cookie, staticRouteTbl = staticRoutes6.staticRoutingSectionGetCur(configRowId)
    else
        configRowId = "-1"
    end
cgilua.header ("Content-Type","text/html; charset=UTF-8")
?>
<div id="tf1_ipv6StaticRoutingDailogContent">
	<div class="topBg">
		<h1 data-localize="13664">IPv6 Static Routing Configuration</h1>
					<close>
						<a href="#" id="btnClose" title="Close">X</a>
					</close>
				</div>
	<div class="dialogMidArea">
		<div class="configRow">
			<label data-localize="12726">Route Name </label> 
			<input type="text" id="tf1_txtRouteName" name="ipv6StaticRouting.routeName" value="$| staticRouteTbl["ipv6StaticRouting.routeName"] or '' |$"  maxlength="64" onkeypress="return alphaNumericCheck (event, '')"> </div>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label data-localize="10070">Active </label>
	            <?lua if (staticRouteTbl["ipv6StaticRouting.active"] == "1") then
					statusStr="enable-disable-on"
                    statusVar = "1"
                else
                	statusStr="enable-disable-off"
                    statusVar = "0"
                end
                ?>
				<a class="$| statusStr |$"  alt="" id="tf1_activateStaticRouting"></a>
				<input type="hidden" name="ipv6StaticRouting.active" value="$| statusVar |$" >
		</div>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label data-localize="11451">IPv6 Destination </label>
			<input type="text" id="tf1_txtDestIpAddr" name="ipv6StaticRouting.destinationIpAddress" value="$| staticRouteTbl["ipv6StaticRouting.destinationIpAddress"] or '' |$" maxlength="40" onkeypress="return numericValueCheck (event, 'ABCDEFabcdef:.')" onkeydown="if (event.keyCode == 9) { return ipv6AddrValidate (this, false, true, ''); }">
		</div>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label data-localize="11463">IPv6 Prefix Length </label>
			<input type="text" id="tf1_txtPreLen" name="ipv6StaticRouting.prefixLength" value="$| staticRouteTbl["ipv6StaticRouting.prefixLength"] or '' |$" class="one" maxlength="3" onkeypress="return numericValueCheck (event)" onkeydown="if (event.keyCode == 9) {return numericValueRangeCheck (this, '', '', 0, 128, true, LANG_LOCALE['11286']+': ', ''); }">
			<dl>
                [<span data-localize="12627">Range</span>: 0 - 128]
			</dl>
		</div>
		<div class="break">
&nbsp; </div>
        <?lua
              local wanDispName 
              local localizeWan 
              local localizeSit0Wan 
              local sit0WanDispName 
		      if(UNIT_NAME == "DSR-1000" or UNIT_NAME == "DSR-1000N" or UNIT_NAME == "DSR-500" or UNIT_NAME == "DSR-500N" or PRODUCT_ID == "DSR-1000AC_Ax" or PRODUCT_ID == "DSR-500AC_Ax" or PRODUCT_ID == "DSR-1000_Bx" or PRODUCT_ID == "DSR-500_Bx") then
			wanDispName = "WAN1"
            localizeWan = "data-localize='30015'"
			sit0WanDispName = "sit0 Tunnel-WAN1"
            localizeSit0Wan = "data-localize='30582'"
		      else
            wanDispName = "WAN1"
            localizeWan = "data-localize='30015'"
			sit0WanDispName = "sit0 Tunnel-WAN1"
            localizeSit0Wan = "data-localize='30582'"
		      end
		?>
		<div class="configRow">
			<label data-localize="11187">Interface </label>
<p><input type="radio" id="tf1_rdInterface1" value="WAN1" $| web.radioSelected(staticRouteTbl["ipv6StaticRouting.interface"] == "WAN1" ) |$ checked name="ipv6StaticRouting.interface">
<span $| localizeWan |$> $|wanDispName|$</span> </p>
            <p><input type="radio" id="tf1_rdInterface3" value="sit0-WAN1" $| web.radioSelected(staticRouteTbl["ipv6StaticRouting.interface"] == "sit0-WAN1" ) |$ name="ipv6StaticRouting.interface"><span $| localizeSit0Wan |$>$|sit0WanDispName|$</span></p>
		</div>
            <p><input type="radio" id="tf1_rdInterface4" value="LAN" $| web.radioSelected(staticRouteTbl["ipv6StaticRouting.interface"] == "LAN" ) |$ name="ipv6StaticRouting.interface"><span data-localize="11515">LAN</span></p>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label>&nbsp; </label>
<p><input type="radio" id="tf1_rdInterface2" value="WAN2" $| web.radioSelected(staticRouteTbl["ipv6StaticRouting.interface"] == "WAN2" ) |$ name="ipv6StaticRouting.interface"> 
<span data-localize="30017">WAN2</span></p>
			<p><input type="radio" id="tf1_rdInterface5" value="sit0-WAN2" $| web.radioSelected(staticRouteTbl["ipv6StaticRouting.interface"] == "sit0-WAN2" ) |$ name="ipv6StaticRouting.interface"><span data-localize="30583">sit0 Tunnel-WAN2</span></p>
		</div>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label data-localize="11454">IPv6 Gateway </label>
			<input type="text" id="tf1_txtGwIpAddr" name="ipv6StaticRouting.gatewayIpAddress" value="$| staticRouteTbl["ipv6StaticRouting.gatewayIpAddress"] or '' |$" maxlength="40" onkeypress="return numericValueCheck (event, 'ABCDEFabcdef:.')" onkeydown="if (event.keyCode == 9) { return ipv6AddrValidate (this, false, true, ''); }">
		</div>
		<div class="break">
&nbsp; </div>
		<div class="configRow">
			<label data-localize="11709">Metric </label>
			<input type="text" class="one" id="tf1_txtMetric" name="ipv6StaticRouting.metric" value="$| staticRouteTbl["ipv6StaticRouting.metric"] or '' |$" maxlength="2" onkeypress="return numericValueCheck (event)" onkeydown="if (event.keyCode == 9) {return numericValueRangeCheck (this, '', '', 2, 15, true, LANG_LOCALE['11303']+': ', '');}">
			<dl>
				[<span data-localize="12627">Range</span>: 2 - 15]
			</dl>
		</div>
		<div class="break">
&nbsp; </div>
    </div>
            <?lua
            local lanv6ip = db.getRowsWhere ("ipAddressTable", "LogicalIfName = 'LAN' and addressFamily = 10")
            local a = 0
            for k,v in pairs (lanv6ip) do
                a = a + 1
                local idVar="hdLanv6IPAddr" .. a
                local preVar = "hdLanv6Prefix" .. a
        ?>
        <input type="hidden" id="$| idVar |$" value="$| v["ipAddressTable.ipAddress"] |$">
        <input type="hidden" id="$| preVar |$" value="$| v["ipAddressTable.ipv6PrefixLen"] |$">
        <?lua
            end
            local ifStatusWAN1 = db.getAttribute("networkinterface", "LogicalIfName", "WAN1", "IfStatus")

            if (ifStatusWAN1 == "2" or ifStatusWAN1 == "3") then
            local wanv6ip = db.getRowsWhere ("ipAddressTable", "LogicalIfName = 'WAN1' and addressFamily = 10")
            a = 0
            for k,v in pairs (wanv6ip) do
                a = a + 1
                local idVar="hdWanv6IPAddr" .. a
                local preVar = "hdWanv6Prefix" .. a
        ?>
        <input type="hidden" id="$| idVar |$" value="$| v["ipAddressTable.ipAddress"] |$">
        <input type="hidden" id="$| preVar |$" value="$| v["ipAddressTable.ipv6PrefixLen"] |$">
        <?lua
            end
        end
            local ifStatusWAN2 = db.getAttribute("networkinterface", "LogicalIfName", "WAN2", "IfStatus")
            if (ifStatusWAN2 == "2" or ifStatusWAN2 == "3") then
            local wan2v6ip = db.getRowsWhere ("ipAddressTable", "LogicalIfName = 'WAN2' and addressFamily = 10")
            a = 0
            for k,v in pairs (wan2v6ip) do
                a = a + 1
                local idVar="hdWan2v6IPAddr" .. a
                local preVar = "hdWan2v6Prefix" .. a
        ?>
        <input type="hidden" id="$| idVar |$" value="$| v["ipAddressTable.ipAddress"] |$">
        <input type="hidden" id="$| preVar |$" value="$| v["ipAddressTable.ipv6PrefixLen"] |$">
        <?lua
        end end
        local sit0Wan1 = db.getAttribute("networkinterface", "LogicalIfName", "sit0-WAN1", "IfStatus")
        if (sit0Wan1 == "2" or sit0Wan1 == "3") then
            local tunnelv6ip = db.getRowsWhere ("ipAddressTable", "LogicalIfName = 'sit0-WAN1' and addressFamily = 10")
        a = 0
        for k,v in pairs (tunnelv6ip) do
            a = a + 1
            local idVar="hdTunnelv6IPAddr" .. a
            local preVar = "hdtunnelPrefix" .. a
        ?>
        <input type="hidden" id="$| idVar |$" value="$| v["ipAddressTable.ipAddress"] |$">
        <input type="hidden" id="$| preVar |$" value="$| v["ipAddressTable.ipv6PrefixLen"] |$">
        <?lua end end 
        local sit0Wan2 = db.getAttribute("networkinterface", "LogicalIfName", "sit0-WAN2", "IfStatus")
        if (sit0Wan2 == "2" or sit0Wan2 == "3") then
            local tunnelv6ipWan2 = db.getRowsWhere ("ipAddressTable", "LogicalIfName = 'sit0-WAN2' and addressFamily = 10")
        a = 0
        for k,v in pairs (tunnelv6ipWan2) do
            a = a + 1
            local idVar="hdSitTunnelv6IPAddr" .. a
            local preVar = "hdSittunnelPrefix" .. a
            ?>
        <input type="hidden" id="$| idVar |$" value="$| v["ipAddressTable.ipAddress"] |$">
        <input type="hidden" id="$| preVar |$" value="$| v["ipAddressTable.ipv6PrefixLen"] |$">
        <?lua end end ?>
        <input type="hidden" id="hdStaticRouteIP" value="" />
        <input type="hidden" id="hdIfStatusWAN1" value="$| ifStatusWAN1 or '' |$">
        <input type="hidden" id="hdIfStatusWAN2" value="$| ifStatusWAN2 or '' |$">
        <input type="hidden" id="hdSit0Wan1" value="$| sit0Wan1 or '' |$">
        <input type="hidden" id="hdSit0Wan2" value="$| sit0Wan2 or '' |$">
	<div class="dialogSubmitRow">
		<input data-localize="12758" type="submit" name="button.config.ipv6StaticRouting.ipv6StaticRouting.$| configRowId |$"  onclick="return ipv6StaticRoutingValidate('tf1_frmIpv6StaticRouting')" class="btnSubmit" title="Save" value="Save" id="btSave">
	</div>
</div>
<?lua end ?>
