<?lua 
    require "teamf1lualib/errorMap"
    require "teamf1lualib/returnCodes"
    require "teamf1lualib/bandwidthProfiles_bl"
    
    local returnCodes = require ("com.teamf1.core.returnCodes")
    local errorMap = require("com.teamf1.core.errorMap")
-- bandwidthProfiles business Logic
    local BWP_bl = require("com.teamf1.bl.network.bandwidthProfiles")

if(ButtonType == "add" or ButtonType == "edit") then
    local returnCode, statusMessage
    if (ButtonType and ButtonType == "edit") then
        configRowId = cgi["configRowId"]
        returnCode, bwProfileTab, vlanTab, optionalWan = BWP_bl.bandwidthProfileGet (configRowId) 
        if (returnCode == returnCodes.SUCCESS) then
            statusSuccessMessage = errorMap.errorStringGet (returnCode)
        else 
            statusErrorMessage = errorMap.errorStringGet (returnCode)
	end
    else
        configRowId = "-1"
        returnCode, bwProfileTab, vlanTab, optionalWan = BWP_bl.bandwidthProfileGet (configRowId) 
    end
    cgilua.header ("Content-Type","text/html; charset=UTF-8")
?>
<div id="tf1_bandwidthProfilesDailogContent">
    <div class="topBg">
        <h1 data-localize="30151">Bandwidth Profile Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">
        <div align="left">
            <div class="configRow" id="tf1_QosName_div">
                <label data-localize="11748">Name</label>
                <?lua if (configRowId == "-1") then ?>
                <input type="text" size="30" name="BandWidthProfile.ProfileName" value="$| bwProfileTab["BandWidthProfile.ProfileName"] or '' |$" id="tf1_QosName" onkeypress="return alphaNumericCheck (event, '')">
                <?lua else ?>
                <p>$| bwProfileTab["BandWidthProfile.ProfileName"] or '' |$</p>
                <input type="hidden" name="BandWidthProfile.ProfileName" value="$| bwProfileTab["BandWidthProfile.ProfileName"] or '' |$" >
                <?lua end ?>
            </div>
            <div class="break" id="break_QosName">&nbsp;</div>
            <div class="configRow" id="tf1_policyType_div">
                <label data-localize="12459">Policy Type</label>
                <select size="1" name="BandWidthProfile.Policy" id="tf1_policyType" onChange="ChangePolicyType('tf1_policyType')">                    
                    <option data-localize="30152" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.Policy"] == "0") |$ value = "0">Outbound</option>
                    <option data-localize="30153" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.Policy"] == "1") |$ value = "1">Inbound</option>
                </select>
            </div>
            <div class="break" id="break_policyType_div">&nbsp;</div>
            <div class="configRow" id="tf1_lanInterface_div">
                <label data-localize="11529">LAN Interface</label>
                <select size="1" name="BandWidthProfile.WANID" id="tf1_lanInterface">
                    <?lua
                        local i = 0
                        local keyval = ""
                        for k,v in pairs(vlanTab) do
                            i = i + 1
                            local row = vlanTab[i]
                            if (row["vlan.portName"] == "dummy") then
                                if(row["vlan.vlanId"] == "1") then
                                    keyval = "LAN"
                                else
                                    keyval = "LAN" .. row["vlan.vlanId"]
                                end
                    ?>
                    <option $| web.dropdownSelected(bwProfileTab["BandWidthProfile.WANID"] == keyval) |$ value = "$| keyval or ''|$">$| row["vlan.vlanName"] or ''|$</option>
                    <?lua
                            end
                        end
                        if(optionalWan == "DMZ") then
                    ?>								
                    <option $| web.dropdownSelected(bwProfileTab["BandWidthProfile.WANID"]== "DMZ") |$ value = "DMZ">DMZ</option>
                    <?lua
                        end
                    ?>
                </select>
            </div>
            <div class="break" id="break_lanInterface_div">&nbsp;</div>
            <?lua
                local wan1DisplayName = "Dedicated WAN"
                local wan2DisplayName = "Configurable WAN"
				local wanDisplayName = "WAN3 Interface"
                local localizeWan1 = "data-localize='30014'"
                local localizeWan2 = "data-localize='30154'"
            ?>
            <div class="configRow" id="tf1_wanInterface_div">
                <label data-localize="13306">WAN Interface</label>
                <select size="1" name="BandWidthProfile.WANID" id="tf1_wanInterface">
                    <option $| localizeWan1 |$ $| web.dropdownSelected(bwProfileTab["BandWidthProfile.WANID"] == "WAN1") |$ value = "WAN1">$| wan1DisplayName |$</option>
                    <?lua

                    if (optionalWan == "WAN2") then
                    ?>
                    <option $| localizeWan2 |$$| web.dropdownSelected(bwProfileTab["BandWidthProfile.WANID"] == "WAN2") |$ value = "WAN2">$| wan2DisplayName |$</option>
                    <?lua end if (UNIT_NAME == "DSR-1000N" or UNIT_NAME == "DSR-1000" or UNIT_NAME == "DSR-1000AC" ) then ?>
                    <option $| web.dropdownSelected(bwProfileTab["BandWidthProfile.WANID"] == "WAN3") |$ value = "WAN3">$| wanDisplayName |$</option>
					<?lua end ?>
                </select>
            </div>
            <div class="break" id="break_wanInterface_div">&nbsp;</div>
            <div class="configRow" id="tf1_profileType_div">
                <label data-localize="12562">Profile Type</label>
                <select size="1" name="BandWidthProfile.ProfileType" id="tf1_profileType" onChange="ChangeProfileType('tf1_profileType')">
                    <option data-localize="12546" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.ProfileType"] == "0") |$ value="0">Priority</option>
                    <option data-localize="30155" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.ProfileType"] == "1") |$ value="1">Rate</option>
                </select>
            </div>
            <div class="break" id="break_profileType">&nbsp;</div>	
            <div class="configRow" id="tf1_priority_div">
                <label data-localize="12546">Priority</label>
                <select size="1" name="BandWidthProfile.Priority" id="tf1_priority">
                    <option data-localize="11633" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.Priority"] == "0") |$ value="0">Low</option>
                    <option data-localize="11705" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.Priority"] == "1") |$ value="1">Medium</option>
                    <option data-localize="11113" $| web.dropdownSelected(bwProfileTab["BandWidthProfile.Priority"] == "2") |$ value="2">High</option>
                </select>
            </div>
            <div class="break" id="break_priority_div">&nbsp;</div>	
            <div class="configRow" id="tf1_minBandwidth_div">
	        <label data-localize="11716">Minimum Bandwidth Rate</label>
                <input name="BandWidthProfile.MinimumRate" value="$| bwProfileTab["BandWidthProfile.MinimumRate"] or '' |$" class="one" type="text" maxlength="6" id="tf1_minBandwidth" onkeypress="return numericValueCheck (event)">
                <dl>[<span data-localize="12627">Range</span>: 1 - <span data-localize="11686">Max. Bandwidth</span>] <span data-localize="11488">Kbps</span></dl>
            </div>
            <div class="break" id="break_minBandwidth_div">&nbsp;</div>
            <div class="configRow" id="tf1_maxBandwidth_div">
                <label data-localize="11695">Maximum Bandwidth Rate</label>
                <input name="BandWidthProfile.MaximumRate" value="$| bwProfileTab["BandWidthProfile.MaximumRate"] or '' |$" class="one" type="text" maxlength="7" id="tf1_maxBandwidth" onkeypress="return numericValueCheck (event)">
                    <dl>[<span data-localize="12627">Range</span>: 100 - 1000000] <span data-localize="11488">Kbps</span></dl>
            </div>
            <div class="break" id="break_maxBandwidth_div">&nbsp;</div>
        </div>
    </div>
    <div class="dialogSubmitRow">
        <input data-localize="12758" type="submit" name="button.config1.bandwidthProfiles.bandwidthProfiles.$|configRowId|$" onclick="return bandwidthProfilesValidation()" class="btnSubmit" title="Save" value="Save" id="btSave">
    </div>
</div>
<!-- Section for Pop up dialog ends -->
<?lua end ?>
