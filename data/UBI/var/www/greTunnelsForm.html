<?lua
require "teamf1lualib/errorMap"
require "teamf1lualib/returnCodes"
require "teamf1lualib/greTunnels_bl"

local errorMap    = require ("com.teamf1.core.errorMap")
local returnCodes = require ("com.teamf1.core.returnCodes")
local gre_bl = require ("com.teamf1.bl.vpn.gre")

if(ButtonType == "add" or ButtonType == "edit") then
    local returnCode, TunnelName, IpAddress, SubnetMask, InterfaceName, 
          RemoteIp, DdpBrd, DstIpAddr, RouteNetMask, GwIpAddr
    if (ButtonType and ButtonType == "edit") then
        configRowId = cgi["configRowId"]
        returnCode, TunnelName, IpAddress, SubnetMask, InterfaceName, 
        RemoteIp, DdpBrd, DstIpAddr, RouteNetMask, GwIpAddr = 
                    gre_bl.greTunnelsSectionGetCur (configRowId) 

        if (returnCode == returnCodes.SUCCESS) then
            statusSuccessMessage = errorMap.errorStringGet (returnCode)
        else 
            statusErrorMessage = errorMap.errorStringGet (returnCode)
	end
    else
        configRowId = "-1"
    end
cgilua.header ("Content-Type","text/html; charset=UTF-8")
?>
<!-- Section for Pop up dialog starts -->
<div id="tf1_greTunnelDailogContent">
    <div class="topBg">
        <h1 data-localize="11080">GRE Tunnels Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">					
        <div class="configRow" id="tf1_greTunnelName_div">
            <label data-localize="11078"> GRE Tunnel Name </label>
            <input type="text" name="greTunnels.TunnelName" value="$| TunnelName or '' |$" id="tf1_greTunnelName" size="20" maxlength="32" onkeypress="return alphaNumericCheck (event, '_')">
        </div>
        <div class="break" id="break_greTunnelName">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_greTunnelIpAddress_div">
            <label data-localize="11387"> IP Address </label>
            <input type="text" name="greTunnels.IpAddress" value="$| IpAddress or '' |$" id="tf1_greTunnelIpAddress" size="20" maxlength="15" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }">
        </div>
        <div class="break" id="break_greTunnelIpAddress">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_greTunnelSubnetMask_div">
            <label data-localize="13017"> Subnet Mask </label>
            <input type="text" name="greTunnels.SubnetMask" value="$| SubnetMask or '' |$" id="tf1_greTunnelSubnetMask" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return validNetMask (this.id) }">
        </div>
        <div class="break" id="break_greTunnelSubnetMask">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_greTunnelInterface_div">
            <label data-localize="11187"> Interface </label>
            <select name="greTunnels.InterfaceName" size="1" id="tf1_greTunnelInterface">
                <option data-localize="30015" $| web.dropdownSelected(InterfaceName == "WAN1") |$ value="WAN1">WAN1</option>
                <option data-localize="30017" $| web.dropdownSelected(InterfaceName == "WAN2") |$ value="WAN2">WAN2</option>
               <?lua if(UNIT_NAME == "DSR-1000" or UNIT_NAME == "DSR-1000N" or PRODUCT_ID == "DSR-1000AC_Ax" or PRODUCT_ID == "DSR-1000_Bx") then ?>
                <option data-localize="30018" $| web.dropdownSelected(InterfaceName == "WAN3") |$ value="WAN3">WAN3</option>
               <?lua end?>
            </select>
        </div>
        <div class="break" id="break_greTunnelInterface">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_greTunnelRemoteAddress_div">
            <label data-localize="12658"> Remote End Address</label>
            <input type="text" name="greTunnels.RemoteIp"  value="$| RemoteIp or '' |$" size="20" maxlength="15" id="tf1_greTunnelRemoteAddress" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }">
        </div>
        <div class="break" id="break_greTunnelRemoteAddress">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_enableModeConfig_div">
            <label data-localize="10879"> Enable DDP Broadcast </label>
            <?lua 
                if ( DdpBrd == "1" ) then
                    statusStr="enable-disable-on"
                    statusVar = "1"
                else
                    statusStr="enable-disable-off"
                    statusVar = "0"
                end
            ?>
            <a class="$| statusStr |$" alt="" id="tf1_enableModeConfig"></a>
            <input type="hidden" value="$| statusVar |$" name="greTunnels.DdpBrd" >
        </div>
	<div class="break" id="break_enableModeConfig">
            &nbsp;
        </div>
        <h2 data-localize="12995">Static Route Configuration </h2>
        <div class="configRow" id="tf1_greTunnelIpAddress2_div">
            <label data-localize="11387"> IP Address </label>
            <input type="text" name="greTunnels.DstIpAddr" value="$| DstIpAddr or '' |$" size="20" maxlength="15" id="tf1_greTunnelIpAddress2" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }">
        </div>
        <div class="break" id="break_greTunnelIpAddress2">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_greTunnelSubnetMask2_div">
            <label data-localize="13017"> Subnet Mask </label>
            <input type="text" name="greTunnels.RouteNetMask" value="$| RouteNetMask or '' |$" id="tf1_greTunnelSubnetMask2" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return validNetMask (this.id) }">
        </div>
        <div class="break" id="break_greTunnelSubnetMask2">
            &nbsp;
        </div>					
        <div class="configRow" id="tf1_greTunnelgatewayAddress_div">
            <label data-localize="11058"> Gateway IP Address </label>
            <input type="text" name="greTunnels.GwIpAddr" value="$| GwIpAddr or '' |$" size="20" maxlength="15" id="tf1_greTunnelgatewayAddress" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }">
        </div>
        <div class="break" id="break_greTunnelgatewayAddress">
            &nbsp;
        </div>
    </div>
    <div class="dialogSubmitRow">
        <input data-localize="12758" type="submit" name="button.config.greTunnels.greTunnels.$| configRowId |$" onclick="return validateGreTunnelsConfig()" class="btnSubmit" title="Save" value="Save" id="btSave">
    </div>
</div>
<!-- Section for Pop up dialog ends -->
<?lua end ?>
