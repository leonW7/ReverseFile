<?lua
require "teamf1lualib/bridgeTrafficSelectors_bl"
require "teamf1lualib/errorMap"
require "teamf1lualib/returnCodes"

local returnCodes = require ("com.teamf1.core.returnCodes")
local errorMap = require("com.teamf1.core.errorMap")
-- bridge traffic Selector business Logic
local BTS_bl = require("com.teamf1.bl.network.bridgeTrafficSelectors")
local returnCode, statusMessage

returnCode, serviceTable = BTS_bl.bridgeServicesGetAll()
if (returnCode == returnCodes.SUCCESS) then
    statusSuccessMessage = errorMap.errorStringGet (returnCode)
end
returnCode, L2BandWidthProfileTable = BTS_bl.bridgeBandwidthProfilesGetAll()
if (returnCode == returnCodes.SUCCESS) then
    statusSuccessMessage = errorMap.errorStringGet (returnCode)
end

if(ButtonType == "add" or ButtonType == "edit") then
-- irrespective of button 
   if (ButtonType and ButtonType == "edit") then
       configRowId = cgi["configRowId"]
       errorFlag, BTS_Table = BTS_bl.bridgeTrafficSelectorGet (configRowId) 
       if (returnCode == returnCodes.SUCCESS) then
           statusSuccessMessage = errorMap.errorStringGet (returnCode)
       else 
           statusErrorMessage = errorMap.errorStringGet (returnCode)
       end
   else
       configRowId = "-1"
       errorFlag, BTS_Table = BTS_bl.bridgeTrafficSelectorGet (configRowId) 
   end
end
cgilua.header ("Content-Type", "text/html; charset=UTF-8")
?>
<div id="tf1_bridgeTrafficSelectorsDailogContent">
    <div class="topBg">
        <h1 data-localize="30169">Bridge Traffic Selector Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">
        <div align="left">
            <div class="configRow" id="tf1_profiles_div">
                <label data-localize="10342">Available Profiles</label>
                <select size="1" name="L2TrafficSelector.ProfileName" id="tf1_profiles" onchange="checkProfileType ();">
                <?lua
                    local i = 0
                    for k,v in pairs(L2BandWidthProfileTable) do
                        i = i + 1
                        local row = L2BandWidthProfileTable[i]
                ?>
                    <option bound="$| row["L2BandWidthProfile.Policy"] or '' |$" value="$| row["L2BandWidthProfile.ProfileName"] |$" $| web.dropdownSelected(BTS_Table["L2TrafficSelector.ProfileName"] == row["L2BandWidthProfile.ProfileName"]) |$>$| row["L2BandWidthProfile.ProfileName"] |$</option>
                <?lua
                    end
                ?>
                </select>
            </div>
            <div class="break" id="break_profiles_div">&nbsp;</div>
            <div class="configRow" id="tf1_service_div">
                <label data-localize="12831">Service</label>
		        <select size="1" name="L2TrafficSelector.ServiceName" id="tf1_service">
                <?lua
                    local i = 0
                    for k,v in pairs(serviceTable) do
                        i = i + 1
                        local row = serviceTable[i]
                            if (row["Services.Protocol"] ~= "58") then
                ?>
                    <option $| web.dropdownSelected(BTS_Table["L2TrafficSelector.ServiceName"] == row["Services.ServiceName"]) |$ value="$| row["Services.ServiceName"] |$">$| row["Services.ServiceName"] |$</option>
                <?lua
                            end
                    end
                ?>
                </select>
            </div>
            <div class="break" id="break_service_div">&nbsp;</div>
	    <!-- For match type outbound -->
            <div class="configRow" id="tf1_bridgeTrafficSelectorOut_div">
                <label data-localize="13130">Traffic Selector Match Type</label>
		<select size="1" name="L2TrafficSelector.MatchType" id="tf1_bridgeTrafficSelectorOut" onChange="optionCheck('tf1_bridgeTrafficSelectorOut')">
                    <option data-localize="11384" $| web.dropdownSelected(BTS_Table["L2TrafficSelector.MatchType"] == "1") |$ value="1">IP</option>
                    <option data-localize="14043" $| web.dropdownSelected(BTS_Table["L2TrafficSelector.MatchType"] == "2") |$ value="2">MAC Address</option>
                </select>
            </div>
            <div class="break" id="break_bridgeTrafficSelectorOut_div">&nbsp;</div>
	    <!-- For match type outbound end-->
            <!-- For match type inbound -->
            <div class="configRow" id="tf1_bridgeTrafficSelectorIn_div">
                <label data-localize="13130">Traffic Selector Match Type</label>
		<select size="1" name="L2TrafficSelector.MatchType" id="tf1_bridgeTrafficSelectorIn" onChange="optionCheck('tf1_bridgeTrafficSelectorIn')">
                    <option data-localize="11384" $| web.dropdownSelected(BTS_Table["L2TrafficSelector.MatchType"] == "1") |$ value="1">IP</option>
                    <option data-localize="14043" $| web.dropdownSelected(BTS_Table["L2TrafficSelector.MatchType"] == "2") |$ value="2">MAC Address</option>
                </select>
            </div>
	    <!-- For match type inbound end -->
            <div class="break" id="break_bridgeTrafficSelectorIn_div">&nbsp;</div>	
            <div class="configRow" id="tf1_ipAddress_div">
                <label data-localize="11387">IP Address</label>
                <input type="text" name="L2TrafficSelector.IPAddress" id="tf1_ipAddress" maxlength="15" value="$| BTS_Table["L2TrafficSelector.IPAddress"] or '' |$" onKeyPress="return numericValueCheck (event, '.')" onKeyDown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281'], LANG_LOCALE['11031'], true); }">
            </div>
            <div class="break" id="break_ipAddress_div">&nbsp;</div>	
            <div class="configRow" id="tf1_subnetMask_div">
                <label data-localize="13017">Subnet Mask</label>
                <input type="text" name="L2TrafficSelector.SubnetMask" value="$| BTS_Table["L2TrafficSelector.SubnetMask"] or '' |$" id="tf1_subnetMask" maxlength="15" onKeyPress="return numericValueCheck (event, '.')" onKeyDown="if (event.keyCode == 9) { return validNetMask (this.id) }">
            </div>
            <div class="break" id="break_subnetMask_div">&nbsp;</div>
            <div class="configRow" id="tf1_txtMacAddr_div">
                <label data-localize="11636">MAC Address</label>
                <input type="text" name="L2TrafficSelector.MACAddress" value="$| BTS_Table["L2TrafficSelector.MACAddress"] or '' |$" id="tf1_txtMacAddr" maxlength="17" onKeyPress="return numericValueCheck (event, 'ABCDEFabcdef:')" onKeyDown="return macAddrVerify (event, this, true, '', '')">
            </div>
            <div class="break" id="break_txtMacAddr_div">&nbsp;</div>
    	</div>
    </div>
    <div class="dialogSubmitRow">
		<input type="submit" onclick="return bridgeTrafficSelectorValidation ('tf1_frmBridgeTrafficSelectors')" class="btnSubmit" title="Save" value="Save" id="btSave" name="button.config.bridgeTrafficSelectors.bridgeTrafficSelectors.$| configRowId |$">
    </div>
</div>
