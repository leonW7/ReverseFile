<?lua
require "teamf1lualib/errorMap"
require "teamf1lualib/returnCodes"
require "teamf1lualib/sessionLimitProfiles_bl"

local SLP_bl = require ("com.teamf1.bl.network.sessionLimiting")

local returnCode, cookie, profileName, sourceType, startIPAddress,
      endIPAddress, interface, maximumSessions, enableSchedules,
      scheduleProfile
if (ButtonType and ButtonType == "edit") then
    configRowId = cgi["configRowId"]
    returnCode, cookie, profileName, sourceType, startIPAddress,
    endIPAddress, interface, maximumSessions, enableSchedules,
    scheduleProfile = SLP_bl.sessionLimitProfileGet (configRowId)
else
    configRowId = "-1"
end
cgilua.header ("Content-Type", "text/html; charset=UTF-8")
?>
<div id="tf1_sessionLimitDailogContent">
    <div class="topBg">
        <h1 data-localize="50155">Session Limiting Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">
        <div align="left">
            <div class="configRow" id="tf1_txtProfName_div">
                <label data-localize="12560">Profile Name</label>
		<?lua if (configRowId == "-1") then ?>
                <input type="text" maxlength="64" name="sessionLimit.ProfileName" value="$| profileName or '' |$" id="tf1_txtProfileName" onkeypress="return alphaNumericCheck (event, '')">
		<?lua else ?>
		<p>$| profileName or '' |$</p>
                <input type="hidden" name="sessionLimit.ProfileName" value="$| profileName or '' |$">
		<?lua end ?>
            </div>
	        <div class="break" id="break_txtProfileName_div">&nbsp;</div>

            <div class="configRow" id="tf1_sourceType_div">
			    <label data-localize="50152">Source Type</label>
			    <select size="1" name="sessionLimit.SourceType" id="tf1_sourceType" onchange="changeSourceType('tf1_sourceType')">
                    <option data-localize="11384" $| web.dropdownSelected (sourceType == "1") |$ value="1">IP</option>
			        <option data-localize="12627" $| web.dropdownSelected (sourceType == "2") |$ value="2">Range</option>
			        <option data-localize="11187" $| web.dropdownSelected (sourceType == "3") |$ value="3">Interface</option>
			    </select>
            </div>
		    <div class="break" id="break_sourceType_div">&nbsp;</div>
		    
            <div class="configRow" id="tf1_startIpAddr_div">
			    <label data-localize="12968">Start IP Address</label>
			    <input type="text" name="sessionLimit.StartIPAddress" value="$| startIPAddress or '' |$" id="tf1_startIpAddr" maxlength="15" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'SN', false, true, LANG_LOCALE['11281']+'. ', LANG_LOCALE['11031'], true); }">
		    </div>
		    <div class="break" id="break_startIpAddr_div">&nbsp;</div>

		    <div class="configRow" id="tf1_endIpAddr_div">
			    <label data-localize="10923">End IP Address</label>
			    <input type="text" name="sessionLimit.EndIPAddress" value="$| endIPAddress or '' |$" id="tf1_endIpAddr" maxlength="15" onkeypress="return numericValueCheck (event, '.')" onkeydown="if (event.keyCode == 9) { return ipv4AddrValidate (this, 'IP', false, true, LANG_LOCALE['11281']+'. ', LANG_LOCALE['11031'], true); }">
		    </div>
		    <div class="break" id="break_endIpAddr_div">&nbsp;</div>

		    <div class="configRow" id="tf1_interface_div">
                <label data-localize="11187">Interface</label>
                <select name="sessionLimit.Interface" id="tf1_interface">
                    <?lua
                        local errorCode, interfaceTbl = SLP_bl.getInterfaceInfo ()
                        for u, v in pairs (interfaceTbl) do
                    ?>
                    <option $| web.dropdownSelected (interface == v["LogicalIfName"]) |$ value="$| v["LogicalIfName"] |$">$| v["interfaceName"] or '' |$</option>
                    <?lua end?>
                </select>
            </div>
            <div class="break" id="break_interface_div">&nbsp;</div>
            <div class="configRow" id="tf1_sessionLimit_div">
			    <label data-localize="50156">Maximum Sessions</label>
			    <input type="text" name="sessionLimit.MaximumSessions" maxlength="3" value="$| maximumSessions or '100' |$" class="one" id="tf1_sessionLimit" onKeyPress="return numericValueCheck(event)" onKeyDown="if (event.keyCode == 9) { return numericValueRangeCheck (this, '','', 1, 999, true, LANG_LOCALE['50157']+'. ', LANG_LOCALE['11718']); }">
                <dl>
                    [<span data-localize="12627">Range</span>: 1 - 999]
                </dl>
		    </div>
		    <div class="break" id="break_sessionLimit_div">&nbsp;</div>

            <div class="configRow" id="tf1_enableSchedules_div">
			    <label data-localize="50158">Enable Schedules</label>
                <?lua 
                if (enableSchedules == "1") then
	                statusStr="enable-disable-on"
	                statusVar = "1"
                else
		            statusStr="enable-disable-off"
	                statusVar = "0"
                end
                ?>
                <a class="$| statusStr |$" alt="" id="tf1_enableSchedules"></a>
			    <input type="hidden" value="$| statusVar |$" name="sessionLimit.EnableSchedules">
		    </div>
		    <div class="break" id="break_enableSchedules_div">&nbsp;</div>

            <div class="configRow" id="tf1_scheduleProfile_div">
                <label data-localize="50159">Schedule Profile</label>
                <select size="1" name="sessionLimit.ScheduleProfile" id="tf1_scheduleProfile">
                    <?lua 
                    local errorCode, scheduleAllInfo = SLP_bl.getScheduleInfo ()
                    for p, q in pairs (scheduleAllInfo) do
                    ?>
                    <option $| web.dropdownSelected (scheduleProfile == q["ScheduleName"]) |$ value="$| q["ScheduleName"] |$">$| q["ScheduleName"] or '' |$</option>
                    <?lua end ?>
                </select> 
            </div>
            <div class="break" id="break_scheduleProfile_div">&nbsp;</div>
        </div>
    </div>
    <div class="dialogSubmitRow">
	<input type="hidden" name="configRowId" value="$| configRowId |$">
	<?lua if (configRowId == "-1") then ?>
	<input data-localize="12758" type="submit" onclick="return sessionLimitValidation();" class="btnSubmit" title="Save" value="Save" id="btSave" name="button.add.sessionLimit.sessionLimit.$|configRowId|$">
	<?lua else ?>
	<input data-localize="12758" type="submit" onclick="return sessionLimitValidation();" class="btnSubmit" title="Save" value="Save" id="btSave" name="button.edit.sessionLimit.sessionLimit.$|configRowId|$">
	<?lua end ?>
    </div>
</div>
