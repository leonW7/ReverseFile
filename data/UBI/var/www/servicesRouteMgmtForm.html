<?lua
require "teamf1lualib/servicesRouteMgmt_bl"
require "teamf1lualib/errorMap"
require "teamf1lualib/returnCodes"

local errorMap    = require ("com.teamf1.core.errorMap")
local returnCodes = require ("com.teamf1.core.returnCodes")
local serviceRouteMgmt = require ("com.teamf1.bl.servicesRouteMgmt")

if(ButtonType == "add" or ButtonType == "edit") then
    local returnCode, serviceName, serviceInterface, routeInterface, vlanName, policyName
    if (ButtonType and ButtonType == "edit") then
    configRowId = cgi["configRowId"]

        returnCode, serviceName, serviceInterface, routeInterface, vlanName,
        policyName = serviceRouteMgmt.servicesRoutingSectionGetCur(configRowId)
     
        if (returnCode == returnCodes.SUCCESS) then
            statusSuccessMessage = errorMap.errorStringGet (returnCode)
        else 
            statusErrorMessage = errorMap.errorStringGet (returnCode)
	    end
    else
        configRowId = "-1"
    end
    local returnCode, vlanTbl,policyTbl =
    serviceRouteMgmt.routeInterfaceSectionGetAll ()
    
cgilua.header ("Content-Type","text/html; charset=UTF-8")
?>
<div id="tf1_servicesRouteMgmtDailogContent">
    <div class="topBg">
        <h1 data-localize="50086">Service Route Management Configuration</h1>
        <close>
            <a href="#" id="btnClose" title="Close">X</a>
        </close>
    </div>
    <div class="dialogMidArea">
        <div class="configRow" id="tf1_serviceName_div">
            <label data-localize="50087">Service Name</label>
            <select size="1" name="servicesRouteMgmt.serviceName" id="tf1_serviceName">
                <option data-localize="12607" value="1" $| web.dropdownSelected(serviceName == "1") |$>Radius</option>
            </select>
        </div>
        <div class="break" id="break_serviceName_div">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_serviceInterface_div">
            <label data-localize="50083">Service Interface</label>
            <select size="1" name="servicesRouteMgmt.serviceInterface" id="tf1_serviceInterface">
                <option data-localize="50088" value="1" $| web.dropdownSelected(serviceInterface == "1") |$>Primary Auth</option>
                <option data-localize="50089" value="2" $| web.dropdownSelected(serviceInterface == "2") |$>Secondary Auth</option>
                <option data-localize="50090" value="3" $| web.dropdownSelected(serviceInterface == "3") |$>Tertiary Auth</option>
       <?lua if (UNIT_NAME ~= "DSR-250N" and UNIT_NAME ~= "DSR-250" and UNIT_NAME ~= "DSR-150N" and UNIT_NAME ~= "DSR-150") then ?>
                <option data-localize="50091" value="4" $| web.dropdownSelected(serviceInterface == "4") |$>Primary Acct</option>
                <option data-localize="50092" value="5" $| web.dropdownSelected(serviceInterface == "5") |$>Secondary Acct</option>
                <option data-localize="50093" value="6" $| web.dropdownSelected(serviceInterface == "6") |$>Tertiary Acct</option>
       <?lua end?>
            </select>
        </div>
        <div class="break" id="break_serviceInterface_div">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_routeInterface_div">
            <label data-localize="50094">Route Interface</label>
            <select size="1" name="servicesRouteMgmt.routeInterface" id="tf1_routeInterface" onchange="selRouteInterface (this.id);">
                <option data-localize="13272" value="1" $| web.dropdownSelected(routeInterface == "1") |$>VLAN</option>
                <option data-localize="11419" value="2" $| web.dropdownSelected(routeInterface == "2") |$>IPSec</option>
            </select>
        </div>
        <div class="break" id="break_routeInterface_div">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_vlanName_div">
            <label data-localize="13280">VLAN Name</label>
            <select size="1" name="servicesRouteMgmt.vlanName" id="tf1_vlanName">
                <?lua for k,v in pairs (vlanTbl) do 
                configRow = vlanTbl[k] 
                ?>
                
                <option $| web.dropdownSelected(configRow["vlan.vlanName"] ==
                vlanName) |$ value="$| configRow["vlan.vlanName"] |$" > $| configRow["vlan.vlanName"] |$ </option>
                <?lua end?>
            </select>
        </div>
        <div class="break" id="break_vlanName_div">
            &nbsp;
        </div>
        <div class="configRow" id="tf1_policyName_div">
            <label data-localize="12458">Policy Name</label>
            <select size="1" name="servicesRouteMgmt.policyName" id="tf1_policyName">
                <?lua for k,v in pairs (policyTbl) do 
                configRow = policyTbl[k] ?>
                <option $|
                web.dropdownSelected(configRow["IpsecVPNPolicy.VPNPolicyName"]
                == policyName) |$ value="$| configRow["IpsecVPNPolicy.VPNPolicyName"] |$">$| configRow["IpsecVPNPolicy.VPNPolicyName"] |$</option>
                <?lua end?>
            </select>
        </div>
        <div class="break" id="break_policyName_div">
            &nbsp;
        </div>
    </div>
    <div class="dialogSubmitRow">
        <input data-localize="12758" type="submit" name="button.config.servicesRouteMgmt.servicesRouteMgmt.$| configRowId |$" class="btnSubmit" title="Save" value="Save" id="btSave" onclick="return pageValidate ('tf1_servicesRouteMgmtDailogContent');">
    </div>
</div>
<?lua end?>

